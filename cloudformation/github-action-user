AWSTemplateFormatVersion: '2010-09-09'
Description: 'IAM Policy for Gibhub Management'

Resources:
  TransitGatewayPolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      ManagedPolicyName: github-actions
      Users: 
        - 'github-action'
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Action:
              - 'ec2:CreateTransitGateway'
              - 'ec2:DeleteTransitGateway'
              - 'ec2:DescribeTransitGateways'
              - 'ec2:ModifyTransitGateway'
              - 'ec2:CreateTransitGatewayVpcAttachment'
              - 'ec2:DeleteTransitGatewayVpcAttachment'
              - 'ec2:ModifyTransitGatewayVpcAttachment'
              - 'ec2:DescribeTransitGatewayVpcAttachments'
              - 'ec2:CreateTransitGatewayRoute'
              - 'ec2:DeleteTransitGatewayRoute'
              - 'ec2:DescribeTransitGatewayRouteTables'
              - 'ec2:CreateTransitGatewayRouteTable'
              - 'ec2:DeleteTransitGatewayRouteTable'
              - 'ec2:AssociateTransitGatewayRouteTable'
              - 'ec2:DisassociateTransitGatewayRouteTable'
              - 'ec2:CreateTransitGatewayPeeringAttachment'
              - 'ec2:DeleteTransitGatewayPeeringAttachment'
              - 'ec2:AcceptTransitGatewayPeeringAttachment'
              - 'ec2:RejectTransitGatewayPeeringAttachment'
              - 'ec2:ModifyTransitGatewayPeeringAttachment'
              - 'ec2:DescribeTransitGatewayPeeringAttachments'
              - 'ec2:CreateTags'
              - 'ec2:DeleteTags'
              - 'cloudformation:DescribeStacks'
              - 'cloudformation:CreateChangeSet'
              - 'cloudformation:DescribeChangeSet'
              - 'cloudformation:DeleteChangeSet'
              - 'cloudformation:ExecuteChangeSet'
              - 'iam:RemoveRoleFromInstanceProfile'
              - 'ec2:ModifySubnetAttribute'
              - 'ec2:CreateNatGateway'
              - 'ec2:DeleteNatGateway'
              - 'ec2:DescribeNatGateways'
              - 'ec2:DeleteSecurityGroup'
              - 'ec2:AssignPrivateNatGatewayAddress'
              - 'ec2:DisassociateNatGatewayAddress'
              - 'ec2:AuthorizeSecurityGroupIngress'
              - 'ec2:CreateSecurityGroup'
              - 'ec2:RunInstances'
              - 'ec2:DeleteRoute'
              - 'ec2:CreateRoute'
              - 'ec2:DescribeRouteTables'
              - 'ec2:CreateInternetGateway'
              - 'ec2:AttachInternetGateway'
              - 'ec2:DescribeInternetGateways'
              - 'ec2:DescribeSecurityGroups'
              - 'ec2:DeleteInternetGateway'
              - 'ec2:DetachInternetGateway'
              - 'ec2:ModifyVpcAttribute'
              - 'ec2:DescribeVpcAttribute'
              - 'ec2:AllocateAddress'
              - 'ec2:DescribeAddresses'
              - 'ec2:AssociateAddress'
              - 'ec2:DisassociateAddress'
              - 'ec2:DescribeInstances'
              - 'ec2:DescribeInstanceStatus'
              - 'ec2:ReleaseAddress'
              - 'ec2:CreateTags'
              - 'ec2:DeleteTags'
              - 'ec2:DescribeTags'
              - 'ec2:CreateVpc'
              - 'ec2:DescribeVpcs'
              - 'ec2:DeleteVpc'
              - 'ec2:CreateSubnet'
              - 'ec2:DescribeSubnets'
              - 'ec2:DeleteSubnet'
              - 'ec2:CreateRoute'
              - 'ec2:CreateRouteTable'
              - 'ec2:DescribeRouteTables'
              - 'ec2:DeleteRouteTable'
              - 'ec2:AssociateRouteTable'
              - 'ec2:DisassociateRouteTable'
              - 'cloudformation:CreateStack'
              - 'cloudformation:DescribeStacks'
              - 'cloudformation:UpdateStack'
              - 'cloudformation:DeleteStack'
              - 'iam:ListPolicyVersions'
              - 'iam:CreatePolicyVersion'
              - 'iam:DeletePolicyVersion'
              - 'iam:GetPolicyVersion'
              - 'iam:SetDefaultPolicyVersion'
              - 'iam:CreateRole'
              - 'iam:CreatePolicy'
              - 'iam:GetRole'
              - 'iam:GetPolicy'
              - 'iam:AttachRolePolicy'
              - 'iam:PutRolePolicy'
              - 'iam:DeleteRole'
              - 'iam:DeletePolicy'
              - 'iam:DetachRolePolicy'
              - 'iam:DeleteRolePolicy'
              - 'iam:GetRolePolicy'
              - 'iam:ListRolePolicies'
              - 'iam:ListAttachedRolePolicies'
              - 'iam:TagRole'
              - 'iam:GetInstanceProfile'
              - 'iam:RemoveRoleFromInstanceProfile'
              - 'iam:ListInstanceProfilesForRole'
              - 'iam:CreateInstanceProfile'
              - 'iam:DeleteInstanceProfile'
              - 'iam:AddRoleToInstanceProfile'
              - 'iam:PassRole'
              - 'iam:TagPolicy'
            Resource: '*'

Outputs:
  PolicyArn:
    Description: ARN of the created IAM Policy
    Value: 'arn:aws:iam::864981718291:policy/github-actions'
  UserArn:
    Description: ARN of the github-action user
    Value: 'arn:aws:iam::864981718291:user/github-action'